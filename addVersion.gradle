import java.util.regex.Pattern

afterEvaluate {
        preBuild.dependsOn(updateVersion)
}

task updateVersion() {
    doFirst {
        updateVersionToXML(version_channel, version_name, version_code, version_min)
    }
}

def updateVersionToXML(verChannel, verName, verCode, verMin) {
    println("Write Version Infomation")

    def stringsFile = file("src/main/res/values/version.xml")
    def stringsText = stringsFile.getText()

    def pattern = Pattern.compile(String.format("version_code\">.*<"));
    def match = pattern.matcher(stringsText);
    match.find();
    stringsText = match.replaceAll(String.format("version_code\">%s<", verCode))

    pattern = Pattern.compile(String.format("version_name\">.*<"));
    match = pattern.matcher(stringsText);
    match.find();
    stringsText = match.replaceAll(String.format("version_name\">%s<", verName))

    pattern = Pattern.compile(String.format("version_channel\">.*<"));
    match = pattern.matcher(stringsText);
    match.find();
    stringsText = match.replaceAll(String.format("version_channel\">%s<", verChannel))

    pattern = Pattern.compile(String.format("version_min\">.*<"));
    match = pattern.matcher(stringsText);
    match.find();
    stringsText = match.replaceAll(String.format("version_min\">%s<", verMin))

    stringsFile.write(stringsText)
}